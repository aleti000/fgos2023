# Тема 1.1. Работа с интерфейсом командной строки

## Объем
2 часа

## Содержание лекции
- Текстовый интерфейс пользователя. Оболочка Bash, приглашение командной строки, виртуальные консоли, горячие клавиши. Стандарт FHS: структура каталогов. Пути и директории. Создание и копирование файлов. Перемещение, переименование, удаление. Жесткие и символические ссылки. Работа с файлами и каталогами. Чтение текстовых файлов. Текстовые редакторы. Стандартные потоки, pipeline.

## Введение

Лекция посвящена работе с интерфейсом командной строки (CLI) в операционной системе GNU/Linux. Мы рассмотрим текстовый интерфейс пользователя, оболочку Bash, структуру файловой системы по стандарту FHS, основные команды для работы с файлами и каталогами, ссылки, текстовые редакторы и стандартные потоки с pipeline. Эти навыки необходимы для эффективного администрирования систем на базе Linux, где CLI является основным инструментом для выполнения задач.

## Текстовый интерфейс пользователя

Текстовый интерфейс пользователя (TUI) — это способ взаимодействия с ОС через командную строку, в отличие от графического интерфейса (GUI). В Linux TUI предоставляет прямой доступ к ядру и инструментам, позволяя автоматизировать задачи и работать на серверах без графики.

Ключевые элементы TUI:
- **Командная строка**: Строка, куда вводятся команды.
- **Приглашение**: Символы, указывающие готовность к вводу (например, `user@host:~$`).
- **Виртуальные консоли**: Терминалы, доступные по Ctrl+Alt+F1-F6, для многозадачности.
- **Горячие клавиши**: Ctrl+C (прервать), Ctrl+D (конец ввода), Ctrl+Z (приостановить), Tab (автодополнение).

TUI эффективен для скриптинга и удаленного управления.

## Оболочка Bash

Bash (Bourne Again SHell) — стандартная командная оболочка в Linux, основана на sh. Она интерпретирует команды, поддерживает скриптинг и имеет встроенные функции.

Приглашение командной строки: `[username@hostname current_directory]$ `

Виртуальные консоли: Доступны через Ctrl+Alt+F1-F6, позволяют переключаться между сессиями.

Горячие клавиши в Bash:
- Ctrl+A: Начало строки.
- Ctrl+E: Конец строки.
- Ctrl+L: Очистка экрана.
- Ctrl+R: Поиск в истории команд.

Bash поддерживает переменные, циклы и условные операторы для автоматизации.

## Стандарт FHS: структура каталогов

Filesystem Hierarchy Standard (FHS) — стандарт структуры каталогов в Unix-подобных системах.

Основные каталоги:
- `/`: Корень.
- `/bin`: Основные исполняемые файлы.
- `/boot`: Файлы загрузки.
- `/dev`: Устройства.
- `/etc`: Конфигурационные файлы.
- `/home`: Домашние каталоги пользователей.
- `/lib`: Библиотеки.
- `/media`: Точки монтирования съемных носителей.
- `/mnt`: Точки монтирования.
- `/opt`: Дополнительное ПО.
- `/proc`: Информация о процессах.
- `/root`: Домашний каталог root.
- `/sbin`: Системные исполняемые файлы.
- `/srv`: Данные сервисов.
- `/sys`: Информация о системе.
- `/tmp`: Временные файлы.
- `/usr`: Пользовательские программы.
- `/var`: Переменные данные (логи, кэш).

FHS обеспечивает совместимость и организацию.

## Пути и директории

Пути — адреса файлов/каталогов. Абсолютные начинаются с `/`, относительные — от текущего каталога.

Команды навигации:
- `pwd`: Показать текущий каталог.
- `cd /path`: Перейти в каталог.
- `ls`: Список файлов.
- `ls -l`: Подробный список.

Директории создаются `mkdir dirname`, удаляются `rmdir dirname` (если пустые).

## Создание и копирование файлов

Создание файлов:
- `touch filename`: Создать пустой файл.
- `echo "text" > filename`: Создать файл с текстом.

Копирование:
- `cp source dest`: Копировать файл.
- `cp -r source dest`: Копировать каталог рекурсивно.

Примеры: `cp file1.txt file2.txt`, `cp -r /dir1 /dir2`.

## Перемещение, переименование, удаление

Перемещение/переименование: `mv source dest`.

Удаление:
- `rm filename`: Удалить файл.
- `rm -r dirname`: Удалить каталог рекурсивно.
- `rm -rf dirname`: Принудительное удаление без подтверждения.

Осторожно с `rm -rf /` — удалит всю систему.

## Жесткие и символические ссылки

Ссылки — указатели на файлы.

Жесткие ссылки: `ln target linkname` — второй inode на файл. Удаление оригинала не удаляет файл, пока есть ссылки.

Символические ссылки: `ln -s target linkname` — файл-указатель. Если оригинал удален, ссылка "ломается".

Пример: `ln file1.txt hardlink`, `ln -s file1.txt symlink`.

## Работа с файлами и каталогами

Дополнительные команды:
- `find /path -name "pattern"`: Поиск файлов.
- `grep "text" filename`: Поиск текста в файле.
- `chmod permissions file`: Изменить права.
- `chown user file`: Изменить владельца.

Организация файлов важна для администрирования.

## Чтение текстовых файлов

Чтение файлов:
- `cat filename`: Вывести содержимое.
- `less filename`: Просмотр с прокруткой (q для выхода).
- `head -n 10 filename`: Первые 10 строк.
- `tail -n 10 filename`: Последние 10 строк.

Полезно для логов и конфигов.

## Текстовые редакторы

Популярные редакторы:
- **nano**: Простой, встроенный. `nano filename`.
- **vim**: Мощный, модальный. `vim filename`.
- **emacs**: Расширяемый, с GUI.

Выбор зависит от предпочтений; vim распространен в администрировании.

## Стандартные потоки, pipeline

Стандартные потоки — это механизм взаимодействия программ с внешним миром в Unix-подобных системах. Каждая программа имеет три стандартных потока:

- **stdin (стандартный ввод, дескриптор 0)**: Источник данных для программы. По умолчанию — клавиатура. Программа читает данные из stdin.
- **stdout (стандартный вывод, дескриптор 1)**: Выходной поток для нормальных данных. По умолчанию — экран терминала. Программа записывает результаты в stdout.
- **stderr (стандартный вывод ошибок, дескриптор 2)**: Выходной поток для сообщений об ошибках. По умолчанию также экран, но может быть перенаправлен отдельно от stdout.

Потоки позволяют программам работать с данными последовательно, без необходимости знать источник или назначение.

### Перенаправление потоков

Потоки можно перенаправлять для изменения источника или назначения:

- **Перенаправление вывода**:
  - `command > file`: Перенаправить stdout в файл (перезаписать).
  - `command >> file`: Дописать stdout в файл.
  - `command 2> file`: Перенаправить stderr в файл.
  - `command &> file`: Перенаправить оба stdout и stderr в файл.

- **Перенаправление ввода**:
  - `command < file`: Использовать файл как stdin.

Примеры:
- `ls /etc > files.txt`: Сохранить список файлов в files.txt.
- `grep "error" log.txt 2> errors.log`: Найти "error" в log.txt, ошибки в errors.log.
- `sort < unsorted.txt > sorted.txt`: Сортировать файл unsorted.txt и сохранить в sorted.txt.

### Pipeline (конвейер)

Pipeline — это механизм соединения команд, где вывод одной команды становится вводом другой. Обозначается символом `|`.

Синтаксис: `command1 | command2 | command3`

Преимущества:
- Эффективность: Данные передаются напрямую, без промежуточных файлов.
- Комбинирование: Позволяет строить сложные команды из простых.

Примеры:
- `ls /etc | grep conf`: Вывести файлы в /etc, содержащие "conf".
- `cat file.txt | sort | uniq`: Прочитать файл, отсортировать строки, удалить дубликаты.
- `ps aux | grep ssh | awk '{print $2}' | xargs kill`: Найти процессы ssh, извлечь PID, убить их.
- `ls /var/log | wc -l`: Подсчитать количество файлов в /var/log.

Дополнительные инструменты:
- **tee**: Разветвляет поток: `command | tee file | another_command` — выводит в файл и на экран/дальше.
- **xargs**: Преобразует вывод в аргументы для другой команды: `find . -name "*.txt" | xargs rm` — удалить все .txt файлы.

Pipeline и перенаправление — основа мощности CLI, позволяя автоматизировать задачи без программирования.
