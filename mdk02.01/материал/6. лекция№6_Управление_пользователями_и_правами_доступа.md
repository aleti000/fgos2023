# Тема 1.1. Управление пользователями и правами доступа

## Объем
2 часа

## Введение

Управление пользователями и правами доступа является одной из ключевых задач системного администратора в ОС «Альт». В многопользовательской операционной системе важно правильно организовать учетные записи, чтобы обеспечить безопасность, разграничение доступа и эффективное использование ресурсов. Неправильная настройка может привести к утечкам данных, несанкционированному доступу или конфликтам между пользователями.

В этой лекции мы подробно изучим основы многопользовательской модели в ОС «Альт», научимся создавать и управлять пользователями и группами, работать с паролями, настраивать права доступа к файлам. Особое внимание уделим механизмам безопасности в ОС «Альт», таким как TCB (Trusted Computing Base) и PAM (Pluggable Authentication Modules). Лекция включает теоретические объяснения и практические примеры команд в терминале.

**Цели лекции:**
- Понимать основы многопользовательской модели в ОС «Альт»
- Научиться создавать и управлять пользователями и группами
- Освоить работу с паролями и политиками безопасности
- Владеть навыками настройки прав доступа к файлам
- Понимать механизмы безопасности TCB и PAM в ОС «Альт»

**Задачи лекции:**
1. Изучить типы пользователей и групп в Linux
2. Освоить команды для управления учетными записями
3. Научиться работать с UID и GID
4. Понять систему прав доступа (rwx)
5. Изучить специальные права (SUID, SGID, Sticky bit)
6. Освоить настройку политик паролей
7. Понять работу TCB и PAM в ОС «Альт»
8. Научиться диагностировать проблемы с доступом

К концу лекции вы сможете самостоятельно управлять учетными записями и правами в ОС «Альт», что является необходимым навыком для дальнейшего изучения администрирования.

## Многопользовательская модель в ОС «Альт»

ОС «Альт», как и другие дистрибутивы Linux, поддерживает многопользовательскую модель. Это означает, что система может одновременно работать с несколькими пользователями, каждый из которых имеет собственное пространство, права и ресурсы. Это отличает Linux от однопользовательских систем, где все действия выполняются от имени одного пользователя.

**Преимущества многопользовательской модели:**
- **Безопасность:** Каждый пользователь имеет ограниченный доступ, что предотвращает повреждение системы
- **Разделение ресурсов:** Пользователи не могут случайно или намеренно влиять на файлы друг друга
- **Серверные возможности:** Несколько пользователей могут одновременно работать на сервере
- **Аудит и логирование:** Система отслеживает действия каждого пользователя

**Основные компоненты многопользовательской модели:**
- **Пользователи:** Индивидуальные учетные записи (например, user1, admin)
- **Группы:** Коллективы пользователей с общими правами (например, developers, admins)
- **Права доступа:** Разграничение чтения, записи и выполнения файлов

Все пользователи идентифицируются уникальными номерами: UID (User ID) для пользователей и GID (Group ID) для групп. Это позволяет системе эффективно управлять доступом и обеспечивать безопасность.

**Принципы многопользовательской системы:**
1. Каждый процесс запускается от имени определенного пользователя
2. Права доступа к файлам и ресурсам определяются владельцем и правами
3. Root (суперпользователь) имеет неограниченные права
4. Обычные пользователи ограничены в своих действиях для безопасности системы

**Типичные сценарии использования:**
- Рабочая станция с несколькими пользователями
- Сервер с различными уровнями доступа
- Системы с разделением ответственности

Понимание многопользовательской модели необходимо для эффективного администрирования и обеспечения безопасности системы.

## Пользователи системы, группы и учетные записи

### Пользователи

Пользователь — это учетная запись, под которой работает человек или программа в системе. Каждый пользователь имеет уникальные идентификаторы и атрибуты.

**Основные атрибуты пользователя:**
- **Имя (username):** Уникальный идентификатор (например, ivan, admin)
- **UID (User ID):** Числовой идентификатор пользователя
- **Домашний каталог:** /home/username, где хранятся личные файлы
- **Оболочка (shell):** Программа для взаимодействия с системой (обычно /bin/bash)
- **Группа:** Основная группа пользователя

**Типы пользователей:**

**1. Обычные пользователи:**
- UID: 1000 и выше
- Предназначены для повседневной работы
- Ограничены в правах для безопасности
- Имеют собственные домашние каталоги

**2. Системные пользователи:**
- UID: 1-999
- Используются для служб и демонов
- Не предназначены для входа в систему
- Примеры: www-data (веб-сервер), mysql (база данных)

**3. Root (суперпользователь):**
- UID: 0
- Имеет все права в системе
- Используется для административных задач
- Требует осторожности в использовании

### Группы

Группы объединяют пользователей для упрощения управления правами. Это позволяет назначать права доступа сразу нескольким пользователям.

**Типы групп:**

**1. Основная группа:**
- Каждый пользователь принадлежит к одной основной группе
- По умолчанию совпадает с именем пользователя
- Используется при создании новых файлов

**2. Дополнительные группы:**
- Пользователь может быть в нескольких группах
- Предоставляют дополнительные права
- Используются для совместного доступа к ресурсам

**Таблица: Типы пользователей и их UID диапазоны**
| Тип пользователя | UID диапазон | Назначение | Примеры |
|-----------------|-------------|------------|---------|
| Root | 0 | Суперпользователь | root |
| Системные | 1-999 | Службы и демоны | www-data, mysql, sshd |
| Обычные | 1000+ | Повседневная работа | user1, admin, developer |

### Создание и управление учетными записями

**Создание пользователя:**
```bash
sudo useradd username
```

**Расширенные опции:**
```bash
sudo useradd -m -s /bin/bash -G group1,group2 username
```
- `-m`: Создать домашний каталог
- `-s`: Указать оболочку
- `-G`: Добавить в дополнительные группы

**Установка пароля:**
```bash
sudo passwd username
```

**Создание группы:**
```bash
sudo groupadd groupname
```

**Добавление пользователя в группу:**
```bash
sudo usermod -aG groupname username
```

**Просмотр информации о пользователе:**
```bash
id username
groups username
```

**Удаление пользователя:**
```bash
sudo userdel username          # Удалить пользователя
sudo userdel -r username       # Удалить с домашним каталогом
```

**Удаление группы:**
```bash
sudo groupdel groupname
```

**Файлы конфигурации:**
- `/etc/passwd`: Информация о пользователях
- `/etc/shadow`: Пароли пользователей
- `/etc/group`: Информация о группах
- `/etc/gshadow`: Пароли групп

**Пример содержимого /etc/passwd:**
```
username:x:1000:1000:User Name:/home/username:/bin/bash
```
- username: Имя пользователя
- x: Пароль (хранится в /etc/shadow)
- 1000: UID
- 1000: GID
- User Name: Полное имя
- /home/username: Домашний каталог
- /bin/bash: Оболочка

**Пример содержимого /etc/group:**
```
groupname:x:1000:user1,user2
```
- groupname: Имя группы
- x: Пароль группы (редко используется)
- 1000: GID
- user1,user2: Список пользователей

Правильное управление учетными записями — основа безопасности и эффективности системы.

## Понятия UID и GID

### UID (User ID)

UID — уникальный числовой идентификатор пользователя. Система использует UID для внутренних операций, а имя пользователя — для удобства пользователей.

**Важность UID:**
- Система идентифицирует пользователей по UID, а не по имени
- UID используется для проверки прав доступа
- UID сохраняется при переименовании пользователя
- Все файлы и процессы связаны с определенным UID

**Структура UID:**
- **0**: Root (суперпользователь)
- **1-999**: Системные пользователи
- **1000+**: Обычные пользователи

**Изменение UID:**
```bash
sudo usermod -u 1500 username
```

**Важные моменты при изменении UID:**
- Нужно обновить владельца файлов: `sudo find / -user старый_UID -exec chown -h новый_UID {} \;`
- Проверить, что новый UID не занят другим пользователем
- Обновить права на домашний каталог

**Просмотр UID:**
```bash
id username
cat /etc/passwd | grep username
getent passwd username
```

### GID (Group ID)

GID — уникальный числовой идентификатор группы. Аналогично UID, система использует GID для внутренних операций.

**Структура GID:**
- **0**: Группа root
- **1-999**: Системные группы
- **1000+**: Группы пользователей

**Изменение GID:**
```bash
sudo groupmod -g 1500 groupname
```

**Просмотр GID:**
```bash
id username
cat /etc/group | grep groupname
getent group groupname
```

### Взаимосвязь UID и GID

**Основные группы:**
- Каждый пользователь имеет основную группу (обычно с тем же именем)
- При создании файлов они автоматически получают группу создателя

**Дополнительные группы:**
- Пользователь может принадлежать к нескольким группам
- Это расширяет права доступа к файлам

**Пример:**
```bash
# Создаем пользователя с основной группой developers
sudo useradd -g developers -G admins,users username

# Проверяем
id username
# uid=1001(username) gid=1001(developers) groups=1001(developers),1002(admins),100(users)
```

### Практическое применение

**1. Безопасность:**
- UID 0 (root) имеет неограниченные права
- Системные пользователи (1-999) изолированы для безопасности
- Обычные пользователи ограничены в действиях

**2. Администрирование:**
- UID/GID позволяют переименовывать пользователей без потери прав
- Упрощают управление правами доступа
- Позволяют создавать сложные схемы доступа

**3. Мониторинг:**
- Все действия в системе ассоциируются с UID
- Логи содержат UID, а не имена пользователей
- Это повышает надежность аудита

**Типичные задачи:**
```bash
# Найти все файлы пользователя по UID
find / -user 1000

# Найти все файлы группы по GID
find / -group 1000

# Изменить владельца файлов при смене UID
find / -user 1000 -exec chown 1001 {} \;

# Проверить, есть ли конфликты UID
cut -d: -f3 /etc/passwd | sort | uniq -d
```

**Советы:**
- Не используйте UID 0 для обычных пользователей
- Следите за диапазонами UID/GID при добавлении новых пользователей
- Регулярно проверяйте наличие дубликатов UID/GID
- Используйте системные UID/GID только для служб

Понимание UID и GID необходимо для эффективного управления пользователями и обеспечения безопасности системы.

## Работа с паролями

Пароли — основной механизм аутентификации в ОС «Альт». Правильная работа с паролями обеспечивает безопасность системы и защиту данных пользователей.

### Хранение паролей

Пароли в Linux хранятся в зашифрованном виде для безопасности. Основные файлы:

**/etc/shadow:**
- Содержит хэши паролей
- Доступен только root
- Каждая строка содержит информацию о пользователе

**Структура строки в /etc/shadow:**
```
username:$6$salt$hash:days_since_epoch:min_days:max_days:warn_days:inactive_days:expire_date:reserved
```

- `username`: Имя пользователя
- `$6$salt$hash`: Хэш пароля (SHA-512)
- `days_since_epoch`: Дни с 1 января 1970 (последняя смена пароля)
- `min_days`: Минимальное количество дней между сменами
- `max_days`: Максимальное количество дней действия пароля
- `warn_days`: Количество дней для предупреждения
- `inactive_days`: Дней до деактивации после истечения срока
- `expire_date`: Дата истечения учетной записи
- `reserved`: Зарезервировано для будущего использования

**/etc/passwd:**
- Содержит основную информацию о пользователях
- Поле пароля содержит 'x' (указывает на использование /etc/shadow)

### Команды для работы с паролями

**Изменение пароля:**
```bash
passwd                    # Изменить пароль текущего пользователя
sudo passwd username      # Изменить пароль другого пользователя
```

**Политика паролей:**
- Минимум 8 символов
- Сочетание букв, цифр, символов
- Регулярная смена
- Запрет повторного использования

**Инструменты управления паролями:**

**chage — управление сроком действия пароля:**
```bash
sudo chage -m 7 -M 90 -W 7 username
```
- `-m 7`: Минимум 7 дней между сменами
- `-M 90`: Максимум 90 дней действия
- `-W 7`: Предупреждать за 7 дней

**Просмотр информации о пароле:**
```bash
sudo chage -l username
```

**Блокировка и разблокировка пользователя:**
```bash
sudo passwd -l username    # Заблокировать
sudo passwd -u username    # Разблокировать
```

**Установка пустого пароля:**
```bash
sudo passwd -d username    # Удалить пароль (опасно!)
```

### Политики паролей

**Настройка политик в /etc/login.defs:**
```bash
# Минимальная длина пароля
PASS_MIN_LEN    8

# Максимальный срок действия
PASS_MAX_DAYS   99999

# Минимальный срок действия
PASS_MIN_DAYS   0

# Предупреждение за дней
PASS_WARN_AGE   7
```

**PAM (Pluggable Authentication Modules):**
- Гибкая система аутентификации
- Позволяет настраивать политики паролей
- Файлы конфигурации: /etc/pam.d/

**Пример настройки сложности пароля:**
```bash
# В файле /etc/pam.d/common-password
password requisite pam_pwquality.so retry=3 minlen=8 difok=3
```

### Безопасность паролей

**Рекомендации:**
1. Использовать сложные пароли
2. Регулярно менять пароли
3. Не использовать одинаковые пароли
4. Использовать двухфакторную аутентификацию
5. Мониторить попытки входа

**Проверка безопасности:**
```bash
# Проверить, какие пользователи имеют пустые пароли
sudo awk -F: '($2 == "") {print $1}' /etc/shadow

# Проверить, какие пользователи не меняли пароль давно
sudo awk -F: '($5 < 30) {print $1}' /etc/shadow
```

### Восстановление доступа

**Забытый пароль root:**
1. Загрузиться в recovery mode
2. Перемонтировать корневую файловую систему: `mount -o remount,rw /`
3. Изменить пароль: `passwd root`
4. Перезагрузиться

**Создание временного пользователя:**
```bash
sudo useradd -m -s /bin/bash tempuser
sudo passwd tempuser
sudo usermod -aG sudo tempuser
```

### Мониторинг и аудит

**Просмотр попыток входа:**
```bash
# Просмотр успешных входов
sudo last

# Просмотр неудачных попыток
sudo lastb

# Просмотр логов аутентификации
sudo tail -f /var/log/auth.log
```

**Настройка уведомлений:**
```bash
# Настроить уведомления о смене пароля
echo "Пароль изменен для пользователя $(whoami) в $(date)" | mail -s "Смена пароля" admin@example.com
```

Правильная работа с паролями — основа безопасности системы. Следование лучшим практикам и регулярный аудит помогут предотвратить несанкционированный доступ.

## Разграничение доступа к файлам

Разграничение доступа к файлам — один из ключевых механизмов безопасности в ОС «Альт». Система прав позволяет контролировать, кто может читать, изменять или выполнять файлы и каталоги.

### Модель прав доступа

Каждый файл и каталог в Linux имеет владельца, группу и набор прав доступа. Права определяют, что может делать владелец, члены группы и остальные пользователи.

**Три категории пользователей:**
- **user (u)**: Владелец файла
- **group (g)**: Члены группы файла
- **other (o)**: Все остальные пользователи

**Три типа прав:**
- **read (r)**: Право на чтение (4)
- **write (w)**: Право на запись (2)
- **execute (x)**: Право на выполнение (1)

### Просмотр прав доступа

**Команда ls -l:**
```bash
ls -l filename
```

**Пример вывода:**
```
-rw-r--r-- 1 user group 1024 Jan 1 12:00 filename
```

**Расшифровка:**
- `-rw-r--r--`: Права доступа
  - `-`: Тип файла (обычный файл)
  - `rw-`: Права владельца (чтение, запись)
  - `r--`: Права группы (только чтение)
  - `r--`: Права остальных (только чтение)
- `1`: Количество жестких ссылок
- `user`: Владелец
- `group`: Группа
- `1024`: Размер файла
- `Jan 1 12:00`: Дата последнего изменения
- `filename`: Имя файла

### Изменение прав доступа

**chmod — изменение прав доступа:**

**Числовая запись:**
```bash
chmod 755 filename
```
- 7 (rwx): Владелец — чтение, запись, выполнение
- 5 (r-x): Группа — чтение, выполнение
- 5 (r-x): Остальные — чтение, выполнение

**Таблица числовых значений:**
| Право | Значение | Биты |
|-------|----------|------|
| rwx | 7 | 4+2+1 |
| rw- | 6 | 4+2+0 |
| r-x | 5 | 4+0+1 |
| r-- | 4 | 4+0+0 |
| -wx | 3 | 0+2+1 |
| -w- | 2 | 0+2+0 |
| --x | 1 | 0+0+1 |
| --- | 0 | 0+0+0 |

**Символьная запись:**
```bash
chmod u+rwx,g+rx,o+r filename
```
- `u`: Владелец
- `g`: Группа
- `o`: Остальные
- `+`: Добавить права
- `-`: Удалить права
- `=`: Установить права точно

**Примеры:**
```bash
chmod u+x script.sh          # Дать право на выполнение владельцу
chmod g+w document.txt       # Дать право на запись группе
chmod o-r private.txt        # Запретить чтение для остальных
chmod a+r public.txt         # Дать право на чтение всем
chmod 644 file.txt           # Владелец: rw, группа и остальные: r
chmod 755 script.sh          # Владелец: rwx, группа и остальные: rx
```

### Изменение владельца и группы

**chown — изменение владельца:**
```bash
sudo chown user filename              # Изменить владельца
sudo chown user:group filename        # Изменить владельца и группу
sudo chown -R user directory/         # Рекурсивно для каталога
```

**chgrp — изменение группы:**
```bash
sudo chgrp group filename             # Изменить группу
sudo chgrp -R group directory/        # Рекурсивно для каталога
```

### Специальные права доступа

**SUID (Set User ID):**
- Устанавливается на исполняемые файлы
- При запуске файл выполняется с правами владельца
- Числовое значение: 4000

**Пример:**
```bash
chmod u+s /usr/bin/passwd
# Или числовым способом
chmod 4755 /usr/bin/passwd
```

**SGID (Set Group ID):**
- На файлах: выполняется с правами группы
- На каталогах: новые файлы наследуют группу каталога
- Числовое значение: 2000

**Пример:**
```bash
chmod g+s /shared/directory
# Или числовым способом
chmod 2755 /shared/directory
```

**Sticky bit:**
- Устанавливается на каталоги
- Только владелец файла может его удалить
- Числовое значение: 1000

**Пример:**
```bash
chmod +t /tmp
# Или числовым способом
chmod 1777 /tmp
```

**Таблица: Специальные права доступа**
| Право | Файл | Каталог | Пример использования |
|-------|------|---------|---------------------|
| SUID | Выполняется от имени владельца | - | /usr/bin/passwd |
| SGID | Выполняется от имени группы | Новые файлы наследуют группу | /shared/projects |
| Sticky bit | - | Только владелец может удалить файл | /tmp |

### Практические примеры

**1. Настройка прав для веб-сервера:**
```bash
# Домашний каталог пользователя
chmod 755 /home/user

# Документы пользователя
chmod 644 /home/user/documents/*

# Скрипты
chmod 755 /home/user/scripts/*.sh

# Конфиденциальные файлы
chmod 600 /home/user/.ssh/id_rsa
```

**2. Общий каталог для команды:**
```bash
# Создаем каталог
sudo mkdir /shared/team

# Устанавливаем владельца и группу
sudo chown root:developers /shared/team

# Устанавливаем права
sudo chmod 2775 /shared/team

# Теперь все файлы в каталоге будут принадлежать группе developers
```

**3. Безопасные права для конфигурационных файлов:**
```bash
# Конфигурация sudo
sudo chmod 440 /etc/sudoers

# Конфигурация SSH
sudo chmod 644 /etc/ssh/sshd_config

# Приватный ключ SSH
chmod 600 ~/.ssh/id_rsa
```

### Типичные ошибки и решения

**Ошибка 1: Слишком широкие права**
```bash
# Плохо: все могут читать конфиденциальные файлы
chmod 644 /etc/shadow

# Хорошо: только root может читать
chmod 600 /etc/shadow
```

**Ошибка 2: Отсутствие прав на выполнение**
```bash
# Плохо: скрипт не запускается
chmod 644 script.sh

# Хорошо: скрипт можно запустить
chmod 755 script.sh
```

**Ошибка 3: Неправильные права на каталоги**
```bash
# Плохо: нельзя войти в каталог
chmod 644 directory

# Хорошо: можно войти и просматривать
chmod 755 directory
```

### Проверка и диагностика

**Проверка прав:**
```bash
# Проверить права на файл
ls -l filename

# Проверить права рекурсивно
find /path -ls

# Найти файлы с определенными правами
find /path -perm 755
```

**Анализ безопасности:**
```bash
# Найти файлы с SUID
find / -perm -4000 2>/dev/null

# Найти файлы с SGID
find / -perm -2000 2>/dev/null

# Найти файлы с широкими правами
find /home -perm -007 2>/dev/null
```

Правильная настройка прав доступа — основа безопасности системы. Следование принципу наименьших привилегий и регулярный аудит прав помогут предотвратить несанкционированный доступ.

## TCB - система хранения паролей в «Альт»

TCB (Trusted Computing Base) — это концепция защищенной среды в ОС «Альт», которая включает механизмы защиты хранения паролей и аутентификации пользователей.

### Что такое TCB

TCB — это набор компонентов системы, от которых зависит безопасность. В контексте ОС «Альт» TCB включает:
- Ядро системы
- Системные утилиты
- Механизмы аутентификации
- Систему хранения паролей

### Особенности TCB в ОС «Альт»

**1. Раздельное хранение паролей:**
В отличие от традиционного подхода, где все пароли хранятся в одном файле `/etc/shadow`, в ОС «Альт» используется система TCB, где каждый пользователь имеет отдельный файл пароля.

**Структура хранения:**
```
/etc/tcb/
├── username1/
│   └── shadow
├── username2/
│   └── shadow
└── ...
```

**Преимущества такого подхода:**
- **Изоляция:** Компрометация одного файла не затрагивает других пользователей
- **Гибкость:** Можно настраивать политики для отдельных пользователей
- **Безопасность:** Уменьшается поверхность атаки

**2. tcb_chkpwd — модуль проверки паролей:**
- Специальная утилита для проверки паролей
- Интегрирована с PAM
- Обеспечивает безопасную проверку паролей

### Просмотр и управление TCB

**Просмотр TCB:**
```bash
# Просмотреть структуру TCB
ls /etc/tcb/

# Просмотреть файл пароля пользователя
sudo cat /etc/tcb/username/shadow
```

**Формат файла shadow в TCB:**
```
username:$6$salt$hash:18295:0:99999:7:::
```
Аналогичен традиционному `/etc/shadow`, но хранится отдельно для каждого пользователя.

**3. Интеграция с PAM:**
TCB тесно интегрирован с PAM (Pluggable Authentication Modules), что позволяет:
- Гибко настраивать политики аутентификации
- Использовать различные методы проверки паролей
- Обеспечивать многоуровневую безопасность

### Настройка TCB

**1. Включение TCB:**
TCB обычно включен по умолчанию в ОС «Альт». Проверить можно:
```bash
# Проверить наличие TCB
ls /etc/tcb/

# Проверить конфигурацию PAM
cat /etc/pam.d/common-auth | grep tcb
```

**2. Настройка политик паролей:**
```bash
# Настройка через PAM
sudo nano /etc/pam.d/common-password

# Пример настройки
password requisite pam_tcb.so minlen=8 difok=3
```

**3. Мониторинг и аудит:**
```bash
# Просмотр логов аутентификации
sudo tail -f /var/log/auth.log

# Проверка использования TCB
sudo grep tcb /var/log/auth.log
```

### Преимущества TCB

**1. Безопасность:**
- Раздельное хранение паролей снижает риски
- Интеграция с PAM обеспечивает гибкость
- Поддержка современных алгоритмов хэширования

**2. Администрирование:**
- Удобное управление паролями пользователей
- Возможность настройки индивидуальных политик
- Простота интеграции с другими системами

**3. Совместимость:**
- Полная совместимость с традиционными методами
- Поддержка всех стандартных утилит
- Интеграция с LDAP и другими системами аутентификации

### Практическое использование

**1. Создание пользователя с TCB:**
```bash
# Создаем пользователя
sudo useradd -m username

# Устанавливаем пароль (автоматически создается TCB файл)
sudo passwd username
```

**2. Проверка TCB файла:**
```bash
# Проверяем наличие TCB файла
ls -la /etc/tcb/username/

# Проверяем права
ls -la /etc/tcb/username/shadow
```

**3. Диагностика проблем:**
```bash
# Проверка целостности TCB
sudo tcb-check

# Проверка конфигурации PAM
sudo pam-auth-update --check
```

### Сравнение с традиционным подходом

**Таблица: Сравнение TCB и традиционного хранения паролей**
| Характеристика | Традиционный подход | TCB в ОС «Альт» |
|---------------|-------------------|-----------------|
| Хранение | Один файл /etc/shadow | Отдельные файлы /etc/tcb/user/shadow |
| Безопасность | При компрометации — все пароли | При компрометации — только один пользователь |
| Гибкость | Ограниченная | Высокая |
| Интеграция | Стандартная | С PAM и другими системами |
| Администрирование | Простое | Расширенное |

TCB в ОС «Альт» представляет собой современный подход к хранению паролей, обеспечивающий высокий уровень безопасности и гибкость в управлении аутентификацией пользователей.

## Введение в PAM

PAM (Pluggable Authentication Modules) — модульная система аутентификации в Linux, включая ОС «Альт». Она позволяет гибко настраивать способы входа в систему и проверки подлинности пользователей.

### Что такое PAM

PAM — это архитектура, которая отделяет аутентификацию от приложений. Вместо того чтобы каждое приложение само решало, как проверять пароли, оно использует PAM, которая предоставляет модули для различных методов аутентификации.

**Преимущества PAM:**
- **Гибкость:** Можно легко изменять методы аутентификации
- **Безопасность:** Централизованное управление аутентификацией
- **Расширяемость:** Можно добавлять новые модули
- **Совместимость:** Работает с различными приложениями

### Архитектура PAM

PAM состоит из четырех типов модулей:

**1. auth (аутентификация):**
- Проверка учетных данных пользователя
- Примеры: pam_unix.so, pam_ldap.so, pam_google_authenticator.so

**2. account (учетная запись):**
- Проверка доступности учетной записи
- Проверка сроков действия, времени входа и т.д.
- Примеры: pam_access.so, pam_time.so

**3. password (пароль):**
- Управление сменой паролей
- Проверка сложности паролей
- Примеры: pam_unix.so, pam_pwquality.so

**4. session (сессия):**
- Настройка сессии после успешной аутентификации
- Установка переменных окружения, логирование и т.д.
- Примеры: pam_limits.so, pam_env.so

### Конфигурация PAM

**Файлы конфигурации:**
- `/etc/pam.d/` — каталог с конфигурационными файлами
- Каждое приложение имеет свой файл (например, `/etc/pam.d/login`, `/etc/pam.d/sudo`)

**Формат строки конфигурации:**
```
type control module-path module-arguments
```

**Пример:**
```
auth    required    pam_unix.so
account required    pam_unix.so
password required  pam_unix.so
session  required  pam_unix.so
```

**Типы модулей (type):**
- `auth`: Аутентификация
- `account`: Проверка учетной записи
- `password`: Управление паролями
- `session`: Настройка сессии

**Уровни контроля (control):**
- `required`: Модуль должен succeed, но ошибка не критична
- `requisite`: Модуль должен succeed, ошибка критична
- `sufficient`: Если succeed, дальнейшие модули не проверяются
- `optional`: Результат не критичен

### Практические примеры

**1. Базовая конфигурация для входа:**
```bash
# Файл /etc/pam.d/login
auth    required    pam_securetty.so
auth    requisite   pam_nologin.so
auth    required    pam_env.so
auth    required    pam_unix.so
account required    pam_unix.so
password required  pam_unix.so
session  required  pam_unix.so
session  optional  pam_lastlog.so
```

**2. Двухфакторная аутентификация:**
```bash
# Добавляем Google Authenticator
auth    required    pam_google_authenticator.so
```

**3. Ограничение времени входа:**
```bash
# Файл /etc/pam.d/login
account required    pam_time.so
```

**4. Проверка сложности паролей:**
```bash
# Файл /etc/pam.d/common-password
password requisite pam_pwquality.so retry=3 minlen=8 difok=3
```

### Настройка политик безопасности

**1. Ограничение попыток входа:**
```bash
# Файл /etc/pam.d/login
auth    required    pam_tally2.so deny=3 unlock_time=300
```

**2. Блокировка по времени:**
```bash
# Файл /etc/security/time.conf
# Пример: запрет входа в выходные
login;*;user1;Wk23-23
```

**3. Ограничение ресурсов:**
```bash
# Файл /etc/pam.d/common-session
session required pam_limits.so
```

**4. Логирование:**
```bash
# Файл /etc/pam.d/common-session
session optional pam_exec.so /usr/local/bin/log_session.sh
```

### Диагностика и отладка

**1. Проверка конфигурации:**
```bash
# Проверка синтаксиса
sudo pam-auth-update --check

# Тестирование аутентификации
sudo pam_tester username
```

**2. Логирование:**
```bash
# Просмотр логов PAM
sudo tail -f /var/log/auth.log

# Поиск ошибок PAM
sudo grep PAM /var/log/auth.log
```

**3. Отладка:**
```bash
# Включение отладки в конфигурации
auth    required    pam_unix.so debug
```

### Интеграция с TCB

В ОС «Альт» PAM тесно интегрирована с TCB:

```bash
# Пример использования TCB в PAM
auth    required    pam_tcb.so
password required  pam_tcb.so
```

**Преимущества интеграции:**
- Использование преимуществ TCB (раздельное хранение паролей)
- Гибкая настройка политик аутентификации
- Совместимость с традиционными методами

### Безопасность PAM

**1. Резервные модули:**
```bash
# Использование резервного модуля
auth    sufficient  pam_unix.so
auth    required    pam_ldap.so
```

**2. Ограничение доступа:**
```bash
# Ограничение по IP
auth    required    pam_access.so
```

**3. Аудит:**
```bash
# Логирование всех попыток аутентификации
auth    required    pam_exec.so /usr/local/bin/audit_auth.sh
```

### Типичные проблемы и решения

**Проблема 1: Пользователь не может войти**
```bash
# Проверка конфигурации
sudo pam-auth-update

# Проверка логов
sudo tail -f /var/log/auth.log
```

**Проблема 2: Ошибки при смене пароля**
```bash
# Проверка политик паролей
sudo cat /etc/pam.d/common-password

# Проверка сложности паролей
sudo pam_pwquality_check username
```

**Проблема 3: Проблемы с двухфакторной аутентификацией**
```bash
# Проверка модуля
sudo pam_google_authenticator username

# Проверка конфигурации
sudo cat /etc/pam.d/common-auth | grep google
```

PAM — мощная и гибкая система, которая позволяет настроить аутентификацию под любые требования безопасности. Понимание PAM необходимо для эффективного администрирования ОС «Альт».

## Заключение

В этой лекции мы изучили основы управления пользователями и правами доступа в ОС «Альт». Эти знания являются фундаментальными для системного администратора, так как правильная настройка пользователей и прав доступа — основа безопасности и эффективности системы.

**Ключевые моменты:**
- Многопользовательская модель обеспечивает безопасность и разделение ответственности
- UID и GID — основа идентификации пользователей и групп в системе
- Правильная работа с паролями — важнейший элемент безопасности
- Система прав доступа (rwx) позволяет точно контролировать доступ к файлам
- TCB и PAM обеспечивают современные механизмы аутентификации и безопасности

**Лучшие практики:**
- Следовать принципу наименьших привилегий
- Регулярно менять пароли и использовать сложные комбинации
- Настройка прав доступа по принципу "что необходимо"
- Регулярный аудит пользователей и прав доступа
- Использование TCB и PAM для повышения безопасности

**Связь с лабораторными работами:**
- Лабораторное занятие №4: Учетные записи и права доступа
- Лабораторное занятие №6: Управление процессами и службами

**Чек-лист для самопроверки:**
- [ ] Понимаю многопользовательскую модель в ОС «Альт»
- [ ] Могу создавать и управлять пользователями и группами
- [ ] Знаю как работать с UID и GID
- [ ] Умею настраивать права доступа к файлам
- [ ] Понимаю специальные права (SUID, SGID, Sticky bit)
- [ ] Знаю как работать с паролями и политиками безопасности
- [ ] Понимаю работу TCB и PAM в ОС «Альт»
- [ ] Могу диагностировать проблемы с доступом

**Рекомендации для дальнейшего изучения:**
- Изучение LDAP и централизованного управления пользователями
- Изучение SELinux и других систем Mandatory Access Control
- Практика настройки сложных политик доступа
- Изучение аудита и мониторинга безопасности

Управление пользователями и правами доступа — это не только техническая задача, но и важный элемент обеспечения безопасности информационных систем. Регулярная практика и изучение лучших практик помогут стать квалифицированным системным администратором.

## Вопросы для самоконтроля

1. Что такое многопользовательская модель и какие у нее преимущества?
2. Какие типы пользователей существуют в Linux и чем они отличаются?
3. Что такое UID и GID, и зачем они нужны?
4. Как создать пользователя и добавить его в группу?
5. Какие существуют типы прав доступа к файлам?
6. Что такое SUID, SGID и Sticky bit, и когда их использовать?
7. Как работает система TCB в ОС «Альт»?
8. Что такое PAM и для чего она нужна?
9. Как изменить пароль пользователя и настроить политики безопасности?
10. Как диагностировать проблемы с доступом к файлам?

## Практические задания

**Задание 1: Управление пользователями**
1. Создайте трех пользователей: user1, user2, user3
2. Установите пароли для всех пользователей
3. Создайте группу developers и добавьте в нее user1 и user2
4. Проверьте созданные учетные записи командой `id`

**Задание 2: Работа с правами доступа**
1. Создайте файл testfile.txt и каталог testdir
2. Установите права 644 на файл и 755 на каталог
3. Создайте символическую ссылку на файл
4. Проверьте права командой `ls -l`

**Задание 3: Специальные права**
1. Создайте исполняемый файл с SUID правом
2. Создайте каталог с SGID правом
3. Установите Sticky bit на каталог /tmp (если есть права)
4. Проверьте установленные права

**Задание 4: Работа с паролями**
1. Измените пароль для одного из созданных пользователей
2. Установите политику смены пароля (максимум 30 дней)
3. Проверьте настройки командой `chage -l`
4. Заблокируйте и разблокируйте пользователя

**Задание 5: Диагностика**
1. Найдите все файлы с SUID в системе
2. Найдите файлы с широкими правами (777)
3. Проверьте конфигурацию PAM для входа
4. Просмотрите логи аутентификации

## Глоссарий терминов

- **UID (User ID)**: Числовой идентификатор пользователя
- **GID (Group ID)**: Числовой идентификатор группы
- **Root**: Суперпользователь с UID 0
- **SUID (Set User ID)**: Специальное право на выполнение от имени владельца
- **SGID (Set Group ID)**: Специальное право на выполнение от имени группы
- **Sticky bit**: Специальное право на каталоги (только владелец может удалить файл)
- **PAM (Pluggable Authentication Modules)**: Модульная система аутентификации
- **TCB (Trusted Computing Base)**: Система защищенного хранения паролей в ОС «Альт»
- **chmod**: Команда для изменения прав доступа
- **chown**: Команда для изменения владельца файла
- **passwd**: Команда для работы с паролями
- **useradd**: Команда для создания пользователей
- **groupadd**: Команда для создания групп
- **chage**: Команда для управления сроком действия пароля
- **/etc/passwd**: Файл с информацией о пользователях
- **/etc/shadow**: Файл с хэшами паролей
- **/etc/group**: Файл с информацией о группах
- **/etc/tcb/**: Каталог с файлами паролей в системе TCB

## Литература

- Официальная документация ОС «Альт»: https://docs.altlinux.org/
- Руководство по пользователям: https://www.altlinux.org/Users
- PAM документация: https://linux.die.net/man/8/pam
- Книга "Linux System Administration" (Evi Nemeth et al.)
- Форум ОС «Альт»: https://forum.altlinux.org/
- Книга "The Linux Command Line" (William Shotts)