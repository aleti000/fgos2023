# Тема 1.1. Управление пользователями и правами доступа

## Объем
2 часа

## Введение

Управление пользователями и правами доступа является одной из ключевых задач системного администратора. В многопользовательских операционных системах, таких как ОС «Альт» (семейство Linux), важно правильно организовать учетные записи, чтобы обеспечить безопасность, разграничение доступа и эффективное использование ресурсов. Неправильная настройка может привести к утечкам данных, несанкционированному доступу или конфликтам между пользователями.

В этой лекции мы разберем основы многопользовательской модели, научимся создавать и управлять пользователями и группами, работать с паролями, настраивать права доступа к файлам. Особое внимание уделим механизмам безопасности в ОС «Альт», таким как TCB (Trusted Computing Base) и PAM (Pluggable Authentication Modules). Лекция включает теоретические объяснения и практические примеры команд в терминале.

К концу лекции вы сможете самостоятельно управлять учетными записями и правами в ОС «Альт», что необходимо для дальнейшего изучения администрирования.

## Многопользовательская модель в ОС «Альт»

ОС «Альт», как и другие дистрибутивы Linux, поддерживает многопользовательскую модель. Это означает, что система может одновременно работать с несколькими пользователями, каждый из которых имеет собственное пространство, права и ресурсы. Это отличает Linux от однопользовательских систем, где все действия выполняются от имени одного пользователя.

### Преимущества многопользовательской модели
- **Безопасность:** Каждый пользователь имеет ограниченный доступ, что предотвращает повреждение системы.
- **Разделение ресурсов:** Пользователи не могут случайно или намеренно влиять на файлы друг друга.
- **Серверные возможности:** Несколько пользователей могут одновременно работать на сервере.
- **Аудит и логирование:** Система отслеживает действия каждого пользователя.

### Основные компоненты
- **Пользователи:** Индивидуальные учетные записи (например, user1, admin).
- **Группы:** Коллективы пользователей с общими правами (например, developers, admins).
- **Права доступа:** Разграничение чтения, записи и выполнения файлов.

Все пользователи идентифицируются уникальными номерами: UID (User ID) для пользователей и GID (Group ID) для групп.

## Пользователи системы, группы и учетные записи

### Пользователи
Пользователь — это учетная запись, под которой работает человек или программа в системе. Каждый пользователь имеет:
- Имя (username): Уникальный идентификатор (например, ivan).
- Домашний каталог: /home/username, где хранятся личные файлы.
- Оболочку (shell): Программу для взаимодействия с системой (обычно bash).

**Типы пользователей:**
- **Обычные пользователи:** Для повседневной работы (UID от 1000 и выше).
- **Системные пользователи:** Для служб и демонов (UID от 1 до 999, например, www-data для веб-сервера).
- **Root (суперпользователь):** UID 0, имеет все права. Используется осторожно, так как может повредить систему.

### Группы
Группы объединяют пользователей для упрощения управления правами. Например, все разработчики могут входить в группу "dev", и им можно дать доступ к общим файлам.

**Типы групп:**
- **Основная группа:** Каждый пользователь принадлежит к одной основной группе (по умолчанию совпадает с именем пользователя).
- **Дополнительные группы:** Пользователь может быть в нескольких группах.

### Создание и управление учетными записями

**Создание пользователя:**
Команда `useradd` создает нового пользователя.
```bash
sudo useradd ivan  # Создает пользователя ivan
sudo passwd ivan   # Устанавливает пароль
```
Опции: `-m` (создать домашний каталог), `-s /bin/bash` (указать оболочку), `-g group` (основная группа).

**Создание группы:**
```bash
sudo groupadd developers
```

**Добавление пользователя в группу:**
```bash
sudo usermod -aG developers ivan
```

**Просмотр информации:**
- `id username` — показывает UID, GID и группы пользователя.
- `groups username` — показывает группы.
- `/etc/passwd` — файл с информацией о пользователях.
- `/etc/group` — файл с группами.

**Удаление:**
```bash
sudo userdel ivan  # Удаляет пользователя, но оставляет домашний каталог
sudo userdel -r ivan  # Удаляет с каталогом
sudo groupdel developers
```

## Понятия UID и GID

### UID (User ID)
UID — уникальный числовой идентификатор пользователя. Система использует UID для внутренних операций, а имя — для удобства.

- Root: UID 0
- Системные: 1-999
- Обычные: 1000+

**Изменение UID:**
```bash
sudo usermod -u 1500 ivan  # Изменяет UID на 1500
```
После изменения нужно проверить права на файлы, так как они хранятся по UID.

### GID (Group ID)
GID — идентификатор группы, аналогично UID.

**Изменение GID:**
```bash
sudo groupmod -n newname oldname  # Переименовывает группу
```

**Просмотр:**
- `getent passwd username` — детальная информация о пользователе.
- `getent group groupname` — о группе.

UID и GID обеспечивают гибкость: можно переименовывать пользователей/группы без изменения прав на файлы.

## Работа с паролями

Пароли — основной механизм аутентификации. В Linux пароли хэшируются для безопасности.

### Хранение паролей
Пароли хранятся в `/etc/shadow` (доступен только root). Файл содержит хэши, соль и метаданные.

**Структура строки в /etc/shadow:**
```
username:$6$salt$hash:days_since_epoch:min_days:max_days:warn_days:inactive_days:expire_date:reserved
```

- $6 — алгоритм SHA-512.
- Хэш предотвращает чтение пароля в открытом виде.

### Команды для работы с паролями

**Изменение пароля:**
```bash
passwd  # Изменяет пароль текущего пользователя
sudo passwd username  # Для другого пользователя
```

**Политика паролей:**
- Минимум 8 символов.
- Сочетание букв, цифр, символов.
- Регулярная смена.

**Инструменты:**
- `chage` — управляет сроком действия пароля.
```bash
sudo chage -m 7 -M 90 ivan  # Минимум 7 дней, максимум 90
```

**Забытый пароль root:** Загрузитесь в recovery mode и измените с `passwd root`.

## Разграничение доступа к файлам

Права доступа контролируют, кто может читать, изменять или выполнять файлы.

### Модель прав
Каждый файл имеет владельца (user), группу (group) и остальных (others). Права: r (read), w (write), x (execute).

**Просмотр прав:**
```bash
ls -l file.txt
# -rw-r--r-- 1 ivan users 1024 Jan 1 12:00 file.txt
```
- Владелец: ivan (rw-)
- Группа: users (r--)
- Остальные: (r--)

### Изменение прав

**chmod (change mode):**
- Символьный: `chmod u+rwx,g+rx,o-r file.txt` (добавить права пользователю, группе; убрать остальным)
- Числовой: `chmod 755 file.txt` (rwxr-xr-x: 4+2+1=7 для user, 4+1=5 для group, 4+1=5 для others)

**chown (change owner):**
```bash
sudo chown ivan file.txt  # Изменить владельца
sudo chown ivan:developers file.txt  # Владельца и группу
sudo chown -R ivan /home/ivan  # Рекурсивно для каталога
```

**umask:** Маска по умолчанию для новых файлов (обычно 022, файлы 644, каталоги 755).
```bash
umask 027  # Новые файлы: 644-027=617? Wait, actually 644 & ~027 = 640
```

### Специальные права
- **SUID (setuid):** Файл выполняется с правами владельца (chmod u+s).
- **SGID (setgid):** Для группы (chmod g+s), новые файлы в каталоге наследуют группу.
- **Sticky bit:** Только владелец может удалять файлы в каталоге (chmod +t, например /tmp).

## TCB - система хранения паролей в «Альт»

TCB (Trusted Computing Base) — это концепция защищенной среды в ОС. В ОС «Альт» TCB включает механизмы защиты хранения паролей.

### Особенности TCB в «Альт»
- Пароли хранятся в `/etc/tcb/username/shadow` (отдельный файл на пользователя), а не в общем `/etc/shadow`.
- Это повышает безопасность: компрометация одного файла не затрагивает других.
- TCB использует tcb_chkpwd для проверки паролей.

**Просмотр TCB:**
```bash
ls /etc/tcb/
sudo cat /etc/tcb/ivan/shadow
```

TCB интегрирован с PAM и обеспечивает дополнительный слой защиты.

## Введение в PAM

PAM (Pluggable Authentication Modules) — модульная система аутентификации в Linux. Она позволяет гибко настраивать способы входа в систему.

### Как работает PAM
PAM состоит из модулей (библиотек), которые проверяют аутентификацию, учет, пароль и сессию. Конфигурация в `/etc/pam.d/`.

**Пример файла /etc/pam.d/login:**
```
auth    required    pam_unix.so
account required    pam_unix.so
password required  pam_unix.so
session  required  pam_unix.so
```

- auth: Проверка учетных данных.
- account: Проверка доступа (время, попытки).
- password: Изменение пароля.
- session: Настройка сессии (логирование).

### Преимущества PAM
- Гибкость: Можно добавить биометрию, смарт-карты, LDAP.
- Безопасность: Модули можно комбинировать.
- В ОС «Альт» PAM используется для интеграции с TCB и другими механизмами.

**Пример настройки:** Добавить двухфакторную аутентификацию через модуль pam_google_authenticator.

## Заключение

В этой лекции мы изучили основы управления пользователями и правами доступа в ОС «Альт». Многопользовательская модель обеспечивает безопасность и эффективность. Практическое применение команд useradd, chmod, passwd позволит вам администрировать систему. TCB и PAM добавляют современные механизмы защиты.

В следующей лекции мы перейдем к управлению процессами и службами. Практикуйтесь в виртуальной машине, чтобы закрепить материал.

## Вопросы для самоконтроля

1. Что такое многопользовательская модель и ее преимущества?
2. Как создать нового пользователя и добавить его в группу?
3. В чем разница между UID и именем пользователя?
4. Как изменить права доступа к файлу с помощью chmod?
5. Что такое TCB и как оно используется в ОС «Альт»?
6. Как работает PAM и для чего он нужен?
7. Какие команды используются для работы с паролями?
8. Что такое SUID и когда его применять?
9. Как просмотреть группы пользователя?
10. Какие файлы хранят информацию о пользователях и группах?

## Литература

- Официальная документация ОС «Альт»: https://docs.altlinux.org/
- Руководство по пользователям: https://www.altlinux.org/Users
- PAM документация: https://linux.die.net/man/8/pam
- Книга "Linux System Administration" (Evi Nemeth et al.)
- Форум ОС «Альт»: https://forum.altlinux.org/
